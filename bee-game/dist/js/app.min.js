var beeTypes=[{species:"Honey Bee",maxEnergy:25,maxEnergyCapacity:25,pollenCount:0,royalPollenCount:0,honeyCount:10,queenCount:0,royalJellyCount:0,age:0},{species:"Bumble Bee",maxEnergy:25,maxEnergyCapacity:25,pollenCount:0,royalPollenCount:0,honeyCount:10,queenCount:0,royalJellyCount:0,age:0},{species:"Mining Bee",maxEnergy:25,maxEnergyCapacity:25,pollenCount:0,royalPollenCount:0,honeyCount:10,queenCount:0,royalJellyCount:0,age:0},{species:"Leafcutting Bee",maxEnergy:25,maxEnergyCapacity:25,pollenCount:0,royalPollenCount:0,honeyCount:10,queenCount:0,royalJellyCount:0,age:0},{species:"Carpenter Bee",maxEnergy:25,maxEnergyCapacity:25,pollenCount:0,royalPollenCount:0,honeyCount:10,queenCount:0,royalJellyCount:0,age:0}],colonyThreats=[{name:"pesticide",text:"Neonicotinoid Pesticide present",definition:"We run this planet dust. Fight for the pollen but risk energy.",posEffect:"%data% pollen obtained",negEffect:"Overwhelmed, %data% energy has been sapped"},{name:"varroaMite",text:"Varroa Mite attacks!",definition:"External parasitic nightmare. Fight to increase endurance but risk viral infection.",viruses:[{name:"deformedWingVirus",negEffect:"Deformed wing virus has damaged your appendages and reduced energy capacity by %data%",posEffect:"Victory increases max energy by %data%"},{name:"blackQueenCellVirus",negEffect:"Black queen cell virus has killed a queen larva",posEffect:"Victory increases max energy by %data%"},{name:"israeliAcuteParalysisVirus",negEffect:"Israeli acute paralysis virus has depleted your energy by %data%",posEffect:"Victory increases max energy by %data%"}]},{name:"smallHiveBeetle",text:"Small Hive Beetle attacks!",definition:"Vile beetle that infests hive, damaging honeycomb, laying larvae that defecate in honey... discoloring with feces. The bee equivalent of a frat party. Risk honey levels.",negEffect:"Small Hive Beetle has ransacked the hive and %data% honey has been lost",posEffect:"Beetle conquered, honey increased by %data%"},{name:"parasiticPhoridFly",text:"Parasitic Phorid Fly attacks!",definition:'"Zombie Flies" that lay eggs in your abdomen that slowly grow as you go mad. The larvae emerges from your lifeless carcass through your neck. Fight to increase your endurance.',negEffect:"The Parasitic Phorid Fly has successfully implanted egg in your abdomen, max energy will decrease 1 per day. Very Tragic.",posEffect:"Victory increases max energy by %data%"},{name:"climateChange",text:"Humans scoff at clean energy, the subsequent warming kills off some potential future plant life.",definition:"Climate Change"},{name:"rain",text:"Storms a brewin",definition:"Moisture condensed from the atmosphere that falls visibly in separate drops. Risk the water washing all your collected pollen.",negEffect:"An afternoon shower washes away fresh paint, hopscotch, and all your pollen",posEffect:"%data% pollen obtained"},{name:"human",text:"Frenzied child with tennis racket attacks!",definition:"You are lucky they arent trying to set you on fire. Risk it all for glory on the battlefield.",negEffect:"Your jacked bee body is no match for human recreational activities. Your journey ends here.",posEffect:"You sting the child in face, take joy in having inflicted lifelong trauma"},{name:"lostGeneticDiversity",text:"You encounter an industrial bee complex. Mating is not recommended due to lack of genetic variation",definition:"Insect Insest",negEffect:"Queen larva produced eats all your royal jelly and dies.",posEffect:"Way to procreate, queen larva increased by 1"},{name:"malnutrition",text:"You encounter a field of almonds, be careful not to gorge yourself.",definition:"A wide variety of pollen leads to stronger bees. Variety is the spice of life. Risk short term pollen boost.",negEffect:"A monoculture diet has resulted in 50% less pollen collected",posEffect:"%data% pollen obtained"}],caliFlowers=["Calamintha nepetoides","Linaria purpurea","Ceanothus - Ray Hartman","Erigeron karvinskianus","Grindelia stricta","Erigeron glaucus - Wayne Roderick","Lavandula stoechas","Nepeta faasennii","Vitex agnus-castus","Salvia mellifera","Solidago californica","Layia platyglossa","Eriogonum grande rubescens","Eschscholzia californica","Salvia - Indigo Spires","Cosmos sulphureus","Caryoteris incana - Bluebeard","Penstemon heterophyllus","Lavandula intermedia - Provence","Salvia microphylla - Hot Lips","Gilia capitata","Rudbeckia hirta","Bidens ferulifolia","Echium candicans","Helianthus annuus - Sunflower","Cosmos bipinnatus","Salvia uliginosa","Gaillardia grandiflora - Oranges and Lemons","Phacelia tanancetifolia"],chosenBee=beeTypes[Math.floor(Math.random()*beeTypes.length)],climateChangeIndex=22,data="%data%",phoridIndex=0,totalHoney=0,totalJelly=0,beeModel=function(e){this.species=ko.observable(e.species),this.maxEnergy=ko.observable(e.maxEnergy),this.maxEnergyCapacity=ko.observable(e.maxEnergyCapacity),this.pollenCount=ko.observable(e.pollenCount),this.royalPollenCount=ko.observable(e.royalPollenCount),this.honeyCount=ko.observable(e.honeyCount),this.queenCount=ko.observable(e.queenCount),this.royalJellyCount=ko.observable(e.royalJellyCount),this.age=ko.observable(e.age)},controller=function(){var e=this;e.bee=ko.observableArray([]),e.bee.push(new beeModel(chosenBee));var a=Math.floor(13*Math.random()),i=Math.floor(20*Math.random());e.Pos={x:a,y:i},e.Backpack={pollenCollected:0,jellyCollected:0},e.listClick=function(){return e.createHexHive(),!0};var o="%red%",t="%green%",n="%blue%",l=[];e.createHexHive=function(){var r,d,c,s,u,p,h,g,y,f,v,b,m,C=[];for(l=[],$("div").remove(".hexagon"),r=0;r<13;r++){for(C=[],d=0;d<20;d++)p='<div style="background-color:rgb(%red%,%green%,%blue%);"></div>',a==r&&i==d?(p='<div style="background-color:rgb(%red%,%green%,%blue%);"></div>',c=255,s=255,u=255):(h=Math.floor(100*Math.random()).toString(),h>=0&&h<climateChangeIndex?(c=Math.floor(45*Math.random()+175).toString(),s=Math.floor(20*Math.random()+180).toString(),u=Math.floor(45*Math.random()+100).toString(),v=1,b=0,m=caliFlowers[Math.floor(Math.random()*caliFlowers.length)]):h>=23&&h<25?(c=Math.floor(80*Math.random()+150).toString(),s=Math.floor(50*Math.random()).toString(),u=Math.floor(80*Math.random()+150).toString(),v=0,b=1,m=caliFlowers[Math.floor(Math.random()*caliFlowers.length)]):(c=Math.floor(30*Math.random()+50).toString(),s=Math.floor(30*Math.random()+120).toString(),u=Math.floor(30*Math.random()+50).toString(),v=0,b=0,m="")),g={red:c,green:s,blue:u},C.push(g),f=p.replace(o,c),f=f.replace(t,s),f=f.replace(n,u),y=$(f).addClass("hexagon").data("flowerData",{x:r,y:d,p:v,j:b,f:m}),y.on("click",function(){e.updatePos($(this).data("flowerData").x,$(this).data("flowerData").y,$(this).data("flowerData").p,$(this).data("flowerData").j)}),y.on("click",function(){$("#lastflower").replaceWith('<span id="lastflower">'.concat($(this).data("flowerData").f+"</span>"))}),a==r&&i==d?y.on("click",function(){e.createHexHive()}):y.on("click",function(){$(this).addClass("usedFlower"),$("div").removeClass("currentFlower"),$(this).addClass("currentFlower"),$(this).data("flowerData").p=0,$(this).data("flowerData").j=0}),$("#flowerfield").append(y);l.push(C)}var k=e.bee()[0].age();k+=1,k>120&&e.endScreen("age"),e.bee()[0].age(k),e.bee()[0].pollenCount(0),e.Backpack.pollenCollected=0,e.Backpack.jellyCollected=0},e.updatePos=function(o,t,n,l){var r,d,c,s,u,p,h,g,y,f,v,b,m,C,k,w,W,x,E,P,M,B,S,q,H;if(r=e.Pos.y,c=e.Pos.x-(e.Pos.y-(1&e.Pos.y))/2,d=-r-c,s=t,p=o-(t-(1&t))/2,u=-s-p,b=Math.max(Math.abs(s-r),Math.abs(u-d),Math.abs(p-c)),m=e.bee()[0].maxEnergy()-b,e.bee()[0].maxEnergy(m),e.Pos.x=o,e.Pos.y=t,m<0&&e.endScreen("energy"),o==a&&t==i)H=e.bee()[0].maxEnergyCapacity()-phoridIndex,e.bee()[0].maxEnergyCapacity(H),e.bee()[0].maxEnergy(e.bee()[0].maxEnergyCapacity()),y=e.bee()[0].honeyCount(),totalHoney+=e.Backpack.pollenCollected,e.bee()[0].honeyCount(y+e.Backpack.pollenCollected-5),f=e.bee()[0].royalJellyCount(),totalJelly+=e.Backpack.jellyCollected,e.bee()[0].royalJellyCount(f+e.Backpack.jellyCollected),e.bee()[0].royalJellyCount()>=10&&(f=e.bee()[0].royalJellyCount(),e.bee()[0].royalJellyCount(f-10),v=e.bee()[0].queenCount(),e.bee()[0].queenCount(v+1)),e.bee()[0].honeyCount()<0&&e.endScreen("honey");else if(C=b>5?.3:(b+20)/100,k=Math.random(),$("#dialogueWindow").replaceWith("<div id='dialogueWindow'></div>"),C>k){switch($("#flowerfield").hide(),W=colonyThreats[Math.floor(Math.random()*colonyThreats.length)],w=Math.random(),W.name){case"pesticide":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/pesticide400.png' alt='pesticide'></div>").show();break;case"varroaMite":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/varroamite400.png' alt='varroa mite'></div>").show();break;case"smallHiveBeetle":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/beetle400.png' alt='small hive beetle'></div>").show();break;case"parasiticPhoridFly":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/phorid400.png' alt='parasitic phorid fly'></div>").show();break;case"climateChange":B="<div>"+W.text+"</div>",climateChangeIndex>0&&(climateChangeIndex-=1),$("#flowerfield").show();break;case"rain":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/rain400.png' alt='rain'></div>").show();break;case"human":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/human400.png' alt='human'></div>").show();break;case"lostGeneticDiversity":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/diversity400.png' alt='lost genetic diversity'></div>").show();break;case"malnutrition":B="<div>"+W.text+"</div>",$("#eventPic").replaceWith("<div class='col-md-12' id='eventPic'><img class='img-responsive img-rounded' src='art/malnutrition400.png' alt='malnutrition'></div>").show();break;default:$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>Success is the best revenge</div>")}x="<button type='button' class='btn btn-danger active' id='decision'>Risk</button>",E="<button type='button' class='btn btn-danger active' id='decision'>Run</button>",dialogueText3="<button type='button' class='btn btn-secondary active' id='definition'>Info</button>",S=Math.floor(10*Math.random()+1),P=$(x).on("click",function(){switch($("#flowerfield").show(),W.name){case"pesticide":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),h=e.Backpack.pollenCollected,e.Backpack.pollenCollected=h+S,e.bee()[0].pollenCount(e.Backpack.pollenCollected)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),m=e.bee()[0].maxEnergy()-S,e.bee()[0].maxEnergy(m));break;case"varroaMite":if(q=Math.floor(3*Math.random()),w>.5)switch(W.viruses[q].name){case"deformedWingVirus":$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].posEffect.replace(data,S)+"</div>"),H=e.bee()[0].maxEnergyCapacity()+S,e.bee()[0].maxEnergyCapacity(H);break;case"blackQueenCellVirus":$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].posEffect.replace(data,S)+"</div>"),H=e.bee()[0].maxEnergyCapacity()+S,e.bee()[0].maxEnergyCapacity(H);break;case"israeliAcuteParalysisVirus":$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].posEffect.replace(data,S)+"</div>"),H=e.bee()[0].maxEnergyCapacity()+S,e.bee()[0].maxEnergyCapacity(H);break;default:$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>Success is the best revenge</div>")}else switch(W.viruses[q].name){case"deformedWingVirus":$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].negEffect.replace(data,S)+"</div>"),H=e.bee()[0].maxEnergyCapacity()-S,e.bee()[0].maxEnergyCapacity(H);break;case"blackQueenCellVirus":v=e.bee()[0].queenCount(),v>0?(e.bee()[0].queenCount(v-1),$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].negEffect.replace(data,S)+"</div>")):$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>There are no queen larva for black queen cell virus to kill</div>");break;case"israeliAcuteParalysisVirus":$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.viruses[q].negEffect.replace(data,S)+"</div>"),m=e.bee()[0].maxEnergy()-S,e.bee()[0].maxEnergy(m);break;default:$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>Success is the best revenge</div>")}break;case"smallHiveBeetle":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),y=e.bee()[0].honeyCount(),e.bee()[0].honeyCount(y+S)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),y=e.bee()[0].honeyCount(),e.bee()[0].honeyCount(y-S));break;case"parasiticPhoridFly":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),H=e.bee()[0].maxEnergyCapacity()+S,e.bee()[0].maxEnergyCapacity(H)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),phoridIndex+=1,H=e.bee()[0].maxEnergyCapacity()-phoridIndex,e.bee()[0].maxEnergyCapacity(H));break;case"rain":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),h=e.Backpack.pollenCollected,e.Backpack.pollenCollected=h+S,e.bee()[0].pollenCount(e.Backpack.pollenCollected)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),e.bee()[0].pollenCount(0));break;case"human":w>.5?$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),e.endScreen("human"));break;case"lostGeneticDiversity":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),v=e.bee()[0].queenCount(),e.bee()[0].queenCount(v+1)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),e.bee()[0].royalJellyCount(0));break;case"malnutrition":w>.5?($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.posEffect.replace(data,S)+"</div>"),h=e.Backpack.pollenCollected,e.Backpack.pollenCollected=h+S,e.bee()[0].pollenCount(e.Backpack.pollenCollected)):($("#dialogueWindow").replaceWith("<div id='dialogueWindow'>"+W.negEffect.replace(data,S)+"</div>"),h=Math.floor(.5*e.Backpack.pollenCollected),e.bee()[0].pollenCount(h));break;default:$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>Success is the best revenge</div>")}w>.5&&(g=e.Backpack.jellyCollected,e.Backpack.jellyCollected=g+l,h=e.Backpack.pollenCollected,e.Backpack.pollenCollected=h+n,e.bee()[0].pollenCount(e.Backpack.pollenCollected),e.bee()[0].royalPollenCount(e.Backpack.jellyCollected)),$("#eventPic").hide()}),M=$(E).on("click",function(){$("#dialogueWindow").replaceWith("<div id='dialogueWindow'>Safe but hungry</div>"),$("#flowerfield").show(),$("#eventPic").hide()}),infoButton=$(dialogueText3).on("click",function(){$("#dialogueWindow").append("<p id='definitionText'>"+W.definition+"</p>"),$("#definition").hide()}),$("#dialogueWindow").append(B),"climateChange"!=W.name&&($("#dialogueWindow").append(P),$("#dialogueWindow").append(M)),$("#dialogueWindow").append(infoButton)}else g=e.Backpack.jellyCollected,e.Backpack.jellyCollected=g+l,h=e.Backpack.pollenCollected,e.Backpack.pollenCollected=h+n,e.bee()[0].pollenCount(e.Backpack.pollenCollected),e.bee()[0].royalPollenCount(e.Backpack.jellyCollected)},e.endScreen=function(a){var i='<h1>GAME OVER</h1><h3>%reasondeath%</h3><ul><li>Days Lasted: %ddata%</li><li>Total Honey Produced: %hdata%</li><li>Total Royal Jelly Produced: %rdata%</li><li id="finalQueenCount">Queens Produced: %qdata%</li></ul><h3>Thanks for playing!<h3>';switch(i=i.replace("%ddata%",e.bee()[0].age()),i=i.replace("%hdata%",totalHoney),i=i.replace("%rdata%",totalJelly),i=i.replace("%qdata%",e.bee()[0].queenCount()),a){case"honey":i=i.replace("%reasondeath%","Without honey, you cannot produce energy to continue");break;case"human":i=i.replace("%reasondeath%","Your jacked bee body is no match for human recreational activities. Your journey ends here.");break;case"energy":i=i.replace("%reasondeath%","You have run out of energy. Destined to become one with the flower field.");break;case"age":i=i.replace("%reasondeath%","Congratulations! You have lasted the full arbitrary lifespan of a bee!")}$("#flowerfield").hide(),$(".statRow").hide(),$(".gameData").hide(),$("#eventPicRow").hide(),$(".container").append('<div class="row"><div class="col-md-12" id="end">'+i+"</div></div>");var o="<button type='button' class='btn btn-danger active'>Play Again</button>";o=$(o).on("click",function(){location.reload()}),$("#end").append(o)}};ko.applyBindings(new controller);